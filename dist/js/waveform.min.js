var Observable;Observable=function(){function t(){this.observers={}}return t.prototype.observe=function(t,e){return this.observers[t]||(this.observers[t]=[]),this.observers[t].push(e),this},t.prototype.ignore=function(t,e){var i;return i=-1,1===arguments.length?(delete this.observers[t],this):(this.observers[t]&&(i=this.observers[t].indexOf(e),-1!==i&&(this.observers[t][i]=null)),this)},t.prototype.notify=function(t,e){var i,s;if(s=this.observers[t],!s)return this;for(i=0;i<s.length;)null!==s[i]&&s[i](e),++i;for(i=0;i<s.length;)null===s[i]&&s.splice(i,1),++i;return 0===s.length&&delete this.observers[t],this},t}();var Waveform,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function i(){this.constructor=t}for(var s in e)hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,slice=[].slice;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/30)}}(),Waveform=function(t){function e(t){if(this.onMouseDown=bind(this.onMouseDown,this),this.onMouseOver=bind(this.onMouseOver,this),this.onMouseUp=bind(this.onMouseUp,this),this.onMouseOut=bind(this.onMouseOut,this),this.render=bind(this.render,this),e.__super__.constructor.call(this),this.container=t.container,this.canvas=t.canvas,this.data=t.data||[],this.wavesCollection=this.data,this.outerColor=t.outerColor||"transparent",this.reflection=t.reflection||0,this.interpolate=!0,t.interpolate===!1&&(this.interpolate=!1),!this.canvas){if(!this.container)throw"Either canvas or container option must be passed";this.canvas=this.createCanvas(this.container,t.width||this.container.clientWidth,t.height||this.container.clientHeight)}this.context=this.canvas.getContext("2d"),this.width=parseInt(this.context.canvas.width,10),this.height=parseInt(this.context.canvas.height,10),this.waveWidth=2,this.iGutterWidth=1,this.colors={},this.events={},this.active=-1,this.selected=-1,this.isDragging=!1,this.isPlaying=!1,this.isFocus=!1,this.initialize()}return extend(e,t),e.prototype.initialize=function(){this.setColors(),this.updateHeight(),this.update(),this.redraw(),this.bindContainerResize(),this.fireEvent("ready")},e.prototype.bindContainerResize=function(){window.addEventListener("resize",function(t){return function(){return console.log("resive event occured",t.container.clientWidth,"outer is "+t.outerColor),t.clear(),t.width=t.container.clientWidth,t.canvas=null,t.context=null,$(t.container).empty(),t.canvas=t.createCanvas(t.container,t.width,t.container.clientHeight),t.context=t.canvas.getContext("2d"),t.update(),t.redraw()}}(this))},e.prototype.setColors=function(){this.setColor("wave-focus","#333333"),this.setGradient("wave",["#666666",0,"#868686",1]),this.setGradient("wave-active",["#FF3300",0,"#FF5100",1]),this.setGradient("wave-selected",["#993016",0,"#973C15",1]),this.setGradient("gutter",["#6B6B6B",0,"#c9c9c9",1]),this.setGradient("gutter-active",["#FF3704",0,"#FF8F63",1]),this.setGradient("gutter-selected",["#9A371E",0,"#CE9E8A",1]),this.setColor("reflection","#999999"),this.setColor("reflection-active","#FFC0A0")},e.prototype.setColor=function(t,e){return this.colors[t]=e},e.prototype.setGradient=function(t,e){var i,s;for(this.iRefelection=.3,this.waveOffset=Math.round(this.height-this.height*this.iRefelection),i=this.context.createLinearGradient(0,this.waveOffset,0,0),s=0;s<e.length;)i.addColorStop(e[s+1],e[s]),s+=2;this.colors[t]=i},e.prototype.updateHeight=function(){this.waveOffset=Math.round(this.height-this.height*this.reflection),this.reflectionHeight=Math.round(this.height-this.waveOffset),this.waveHeight=this.height-this.reflectionHeight},e.prototype.redraw=function(){requestAnimationFrame(this.render)},e.prototype.render=function(){var t,e,i,s,n,o,r,h,a,c,l,u;for(t=void 0,s=void 0,n=void 0,o=void 0,r=void 0,a=void 0,c=void 0,this.clear(),s=0,r=this.wavesCollection,c=this.width/this.data.length,l=0,u=this.waveOffset,this.context.clearRect(l,u,this.width,this.height),a=[],n=0,o=r.length;o>n;)t=r[n],e=r[n+1],this.selected>0&&this.selected<=n&&n<this.active||this.selected>n&&n>=this.active?this.context.fillStyle=this.colors["wave-selected"]:this.active>n?this.context.fillStyle=this.colors["wave-active"]:this.context.fillStyle=this.colors["wave-focus"],this.context.fillRect(l,u,this.waveWidth,t),this.selected>0&&this.selected<=n&&n<this.active||this.selected>n&&n>=this.active?this.context.fillStyle=this.colors["gutter-selected"]:this.active>n?this.context.fillStyle=this.colors["gutter-active"]:this.context.fillStyle=this.colors.gutter,i=Math.max(t,e),this.context.fillRect(l+this.waveWidth,u,this.iGutterWidth,i),this.reflection>0&&(h=Math.abs(t)/(1-this.reflection)*this.reflection,this.active>s?this.context.fillStyle=this.colors["reflection-active"]:this.context.fillStyle=this.colors.reflection,this.context.fillRect(l,u,this.waveWidth,h)),a.push(s++),l+=this.waveWidth+this.iGutterWidth,n++;return a},e.prototype.clear=function(){return this.context.fillStyle=this.outerColor,this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(0,0,this.width,this.height)},e.prototype.setData=function(t){return this.data=t},e.prototype.getData=function(){return this.data},e.prototype.setDataInterpolated=function(t){return this.setData(this.interpolateArray(t,this.width))},e.prototype.setDataCropped=function(t){return this.setData(this.expandArray(t,this.width))},e.prototype.linearInterpolate=function(t,e,i){return t+(e-t)*i},e.prototype.expandArray=function(t,e,i){var s,n,o,r;if(s=void 0,n=void 0,o=void 0,r=void 0,null===i&&(i=0),o=[],t.length>e)o=t.slice(t.length-e,t.length);else for(s=n=0,r=e-1;r>=0?r>=n:n>=r;)o[s]=t[s]||i,s=r>=0?++n:--n;return o},e.prototype.interpolateArray=function(t,e){var i,s,n,o,r,h,a;for(i=void 0,s=void 0,n=void 0,o=void 0,r=void 0,h=void 0,a=void 0,r=new Array,h=new Number((t.length-1)/(e-1)),r[0]=t[0],o=1;e-1>o;)a=o*h,n=new Number(Math.floor(a)).toFixed(),i=new Number(Math.ceil(a)).toFixed(),s=a-n,r[o]=this.linearInterpolate(t[n],t[i],s),o++;return r[e-1]=t[t.length-1],r},e.prototype.putDataIntoWaveBlock=function(){var t,e,i,s,n,o,r,h,a,c,l;for(o=this.waveWidth+this.iGutterWidth,t=this.getData(),c=[],r=Math.ceil(t.length/o),n=0;r>n;){for(l=0,h=0;o>h;)a=n*o+h,l+=t[a],h++;i=l/o,e=i*this.waveHeight,s=Math.floor(-Math.abs(e)),c.push(s),n++}return c},e.prototype.update=function(){this.interpolate===!1?this.setDataCropped(this.data):this.setDataInterpolated(this.data),this.wavesCollection=this.putDataIntoWaveBlock(this.data)},e.prototype.createCanvas=function(t,e,i){var s;return s=document.createElement("canvas"),t.appendChild(s),s.width=e,s.height=i,s},e.prototype.getMouseClickPosition=function(t){var e,i,s,n;return e=this.canvas,i=e.getBoundingClientRect(),s=Math.round((t.clientX-i.left)/(i.right-i.left)*e.width),n=Math.round((t.clientY-i.top)/(i.bottom-i.top)*e.height),[s,n]},e.prototype.calcPercent=function(){return Math.round(this.clickPercent*this.width/(this.waveWidth+this.iGutterWidth))},e.prototype.fireEvent=function(){var t,e;e=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],this.notify(e,t)},e.prototype.oldfireEvent=function(t){var e;this.events[t]&&(e=[].splice.call(arguments,0),e[0]=this,this.events[t].e.forEach(function(t){t.apply(null,e)}))},e.prototype.bindEventHandlers=function(){return this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mousemove",this.onMouseOver),this.canvas.addEventListener("mouseout",this.onMouseOut),this.canvas.addEventListener("mouseup",this.onMouseUp)},e.prototype.onMouseOut=function(t){this.selected=-1,this.redraw()},e.prototype.onMouseUp=function(t){this.isDragging=!1},e.prototype.onMouseOver=function(t){var e,i,s,n;e=this.getMouseClickPosition(t),n=e[0],s=this.getWaveClicked(n),i=this.getMousePosTrackTime(n),this.fireEvent("hover",i,s),this.isDragging===!0?(this.selected=-1,this.clickPercent=n/this.width,this.active=this.calcPercent()):this.selected=s,this.redraw()},e.prototype.playProgress=function(t){var e;e=Math.round(t/100*this.wavesCollection.length),this.active=e,this.redraw()},e.prototype.calcPercent=function(){return Math.round(this.clickPercent*this.width/(this.waveWidth+this.iGutterWidth))},e.prototype.onMouseDown=function(t){var e,i;this.isDragging=!0,e=this.getMouseClickPosition(t),i=e[0],this.clickPercent=i/this.width,this.fireEvent("click",100*this.clickPercent),this.active=this.calcPercent(),this.redraw()},e.prototype.getWaveClicked=function(t){var e,i,s;return i=Math.round(t/(this.waveWidth+this.iGutterWidth)),s=this.wavesCollection,e=0,e=i>s.length?s.length:0>i?0:i},e.prototype.getMousePosTrackTime=function(t){var e,i;return i=this.trackLength/this.wavesCollection.length*this.getWaveClicked(t),e=0,e=i>this.trackLength?this.trackLength:0>i?0:i},e}(Observable);